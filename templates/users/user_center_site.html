<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>美多商城-用户中心</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ static('css/reset.css') }}">
    <link rel="stylesheet" href="{{ static('css/main.css') }}">

    <!-- JS -->
    <script src="{{ static('js/host.js') }}"></script>
    <script src="{{ static('js/vue-2.5.16.js') }}"></script>
    <script src="{{ static('js/axios-0.18.0.min.js') }}"></script>

    <script>
        let addresses = {{ addresses | tojson }};
        let default_address_id = {{ default_address_id | tojson }};
    </script>
</head>
<body>

<div id="app" v-cloak>

    <!-- 顶部 -->
    <div class="header_con">
        <div class="header">
            <div class="welcome fl">欢迎来到美多商城!</div>
            <div class="fr">
                <div class="login_info fl">
                    欢迎您：<em>{{ request.user.username }}</em>
                </div>
                <div class="user_link fl">
                    <span>|</span>
                    <a href="{{ url('users:center') }}">用户中心</a>
                    <span>|</span>
                    <a href="#">我的购物车</a>
                </div>
            </div>
        </div>
    </div>

    <!-- 主体 -->
    <div class="main_con clearfix">
        <div class="left_menu_con clearfix">
            <h3>用户中心</h3>
            <ul>
                <li>
                    <a href="{{ url('users:center') }}">· 个人信息</a>
                </li>
                <li>
                    <a href="{{ url('users:addresses') }}" class="active">· 收货地址</a>
                </li>
            </ul>
        </div>

        <div class="right_content clearfix">
            <div class="site_top_con">
                <a @click="show_add_site">新增收货地址</a>
                <span>
                    你已创建了 <b>[[ addresses.length ]]</b> 个收货地址，
                    最多可创建 <b>20</b> 个
                </span>
            </div>

            <div class="site_con" v-for="(address, index) in addresses">
                <div class="site_title">
                    <h3>[[ address.title ]]</h3>
                    <em v-if="address.id === default_address_id">默认地址</em>
                    <span class="del_site" @click="delete_address(index)">×</span>
                </div>

                <ul class="site_list">
                    <li><span>收货人：</span><b>[[ address.receiver ]]</b></li>
                    <li>
                        <span>所在地区：</span>
                        <b>[[ address.province ]] [[ address.city ]] [[ address.district ]]</b>
                    </li>
                    <li><span>地址：</span><b>[[ address.place ]]</b></li>
                    <li><span>手机：</span><b>[[ address.mobile ]]</b></li>
                    <li><span>固定电话：</span><b>[[ address.tel ]]</b></li>
                    <li><span>电子邮箱：</span><b>[[ address.email ]]</b></li>
                </ul>

                <div class="down_btn">
                    <a v-if="address.id !== default_address_id"
                       @click="set_default(index)">设为默认</a>
                    <a href="javascript:;" class="edit_icon"
                       @click="show_edit_site(index)">编辑</a>
                </div>
            </div>
        </div>
    </div>

    <!-- 弹窗 -->
    <div class="pop_con" v-show="is_show_edit">
        <div class="site_con site_pop">
            <div class="site_pop_title">
                <h3>[[ editing_address_index ? '编辑收货地址' : '新增收货地址' ]]</h3>
                <a @click="is_show_edit=false">×</a>
            </div>

            <form>
                <div class="form_group">
                    <label>*收货人：</label>
                    <input v-model="form_address.receiver" type="text">
                </div>

                <div class="form_group">
                    <label>*所在地区：</label>
                    <select v-model="form_address.province_id">
                        <option value="">请选择省</option>
                        <option v-for="p in provinces" :value="p.id">[[ p.name ]]</option>
                    </select>
                    <select v-model="form_address.city_id">
                        <option value="">请选择市</option>
                        <option v-for="c in cities" :value="c.id">[[ c.name ]]</option>
                    </select>
                    <select v-model="form_address.district_id">
                        <option value="">请选择区</option>
                        <option v-for="d in districts" :value="d.id">[[ d.name ]]</option>
                    </select>
                </div>

                <div class="form_group">
                    <label>*详细地址：</label>
                    <input v-model="form_address.place" type="text">
                </div>

                <div class="form_group">
                    <label>*手机：</label>
                    <input v-model="form_address.mobile" type="text">
                </div>

                <div class="form_group">
                    <label>固定电话：</label>
                    <input v-model="form_address.tel" type="text">
                </div>

                <div class="form_group">
                    <label>邮箱：</label>
                    <input v-model="form_address.email" type="text">
                </div>

                <input
                  @click.prevent="save_address"
                  type="button"
                  :value="editing_address_index === '' ? '新 增' : '保 存'"
                  class="info_submit">

                <input @click.prevent="is_show_edit=false" type="button" value="取 消"
                       class="info_submit info_reset">
            </form>
        </div>
    </div>

</div>

<script src="{{ static('js/common.js') }}"></script>
<script src="{{ static('js/user_center_site.js') }}"></script>

</body>
</html>
